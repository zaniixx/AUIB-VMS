{% extends 'base.html' %}
{% import '_macros.html' as ui %}

{% block title %}Register{% endblock %}

{% block body %}
<div class="narrow-wrapper">
  {% call ui.card(title='Create Your Volunteer Account', subtitle='Join AUIB VMS and start tracking your volunteer hours.') %}
    <form method="POST" action="{{ url_for('auth.register') }}" data-validate>
      {{ ui.form_input(
        name='name',
        label='Full Name',
        type='text',
        required=true,
        placeholder='John Doe',
        autocomplete='name',
        help_text='Enter your full name as it should appear on certificates'
      ) }}

      <div class="form-group">
        <label for="email-username" class="form-label form-label--required">
          AUIB Email Address
        </label>
        <div class="input-group">
          <input type="text"
                 id="email-username"
                 name="email-username"
                 class="form-input"
                 required
                 placeholder="your.name"
                 pattern="[a-zA-Z0-9._-]+"
                 title="Only letters, numbers, dots, hyphens and underscores allowed"
                 autocomplete="username">
          <span class="input-group-suffix">@auib.edu.iq</span>
        </div>
        <input type="hidden" id="email" name="email" value="">
        <span class="form-help">Enter your AUIB email username only</span>
      </div>

      {{ ui.form_input(
        name='password',
        label='Password',
        type='password',
        required=true,
        placeholder='Enter a secure password',
        autocomplete='new-password',
        help_text='Minimum 8 characters recommended'
      ) }}

      <div class="form-group">
        <button type="submit" class="btn btn--primary btn--full">
          Create Account
        </button>
      </div>
    </form>

    <hr style="margin: var(--space-6) 0; border: none; border-top: 1px solid var(--color-gray-200);">

    <div class="text-center">
      <p style="margin-bottom: var(--space-3); color: var(--color-gray-600); font-size: var(--text-sm);">
        Already have an account?
      </p>
      <a href="{{ url_for('auth.login') }}" class="btn btn--outline btn--full">
        Sign In
      </a>
    </div>
  {% endcall %}

  {{ ui.alert(
    'After registration, you can start signing up for volunteer events and tracking your service hours.',
    type='info',
    title='Welcome to AUIB VMS'
  ) }}
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Combine username with domain before form submission
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form[data-validate]');
    const usernameInput = document.getElementById('email-username');
    const emailInput = document.getElementById('email');
    
    if (form && usernameInput && emailInput) {
      form.addEventListener('submit', function(e) {
        // Combine username with @auib.edu.iq domain
        const username = usernameInput.value.trim();
        if (username) {
          emailInput.value = username + '@auib.edu.iq';
        }
      });
    }
  });
</script>
{% endblock %}
