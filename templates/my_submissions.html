{% extends 'base.html' %}
{% import '_macros.html' as ui %}

{% block title %}My Submissions{% endblock %}

{% block body %}
<div class="content-wrapper">
  <div style="margin-bottom: var(--space-8);">
    <h1 style="margin-bottom: var(--space-2);">My Bulk Submissions</h1>
    <p style="color: var(--color-gray-600);">
      View the status and history of your bulk volunteer hour submissions.
    </p>
  </div>

  {% if submissions %}
    <div style="display: flex; flex-direction: column; gap: var(--space-6);">
      {%- for s in submissions %}
      {% call ui.card(title=s.project_name, compact=false) %}
        <!-- Submission Metadata -->
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-4); padding-bottom: var(--space-4); border-bottom: 1px solid var(--color-gray-200);">
          <div>
            <div style="font-size: var(--text-sm); color: var(--color-gray-600); margin-bottom: var(--space-1);">
              <strong>Date Range:</strong> {{ s.date_range or 'Not specified' }}
            </div>
            <div style="font-size: var(--text-sm); color: var(--color-gray-500);">
              <strong>Submitted:</strong> {{ s.created_at.strftime('%Y-%m-%d %H:%M') if s.created_at else 'Unknown' }}
            </div>
          </div>
          <div>
            {{ ui.status_badge(s.status) }}
          </div>
        </div>

        <!-- Description -->
        {% if s.description %}
        <div style="margin-bottom: var(--space-4);">
          <h4 style="font-size: var(--text-sm); font-weight: var(--font-semibold); margin-bottom: var(--space-2);">Description</h4>
          <p style="color: var(--color-gray-700); font-size: var(--text-sm);">{{ s.description }}</p>
        </div>
        {% endif %}

        <!-- Hours Summary -->
        <div style="margin-bottom: var(--space-4);">
          <h4 style="font-size: var(--text-sm); font-weight: var(--font-semibold); margin-bottom: var(--space-2);">Hours Summary</h4>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--space-3);">
            <div style="background: var(--color-gray-50); padding: var(--space-3); border-radius: var(--radius);">
              <div style="font-size: var(--text-lg); font-weight: var(--font-semibold); color: var(--color-primary-600);">{{ s.total_volunteers }}</div>
              <div style="font-size: var(--text-xs); color: var(--color-gray-600);">Volunteers</div>
            </div>
            <div style="background: var(--color-gray-50); padding: var(--space-3); border-radius: var(--radius);">
              <div style="font-size: var(--text-lg); font-weight: var(--font-semibold); color: var(--color-success-600);">{{ "%.1f"|format(s.total_hours) }}</div>
              <div style="font-size: var(--text-xs); color: var(--color-gray-600);">Total Hours</div>
            </div>
          </div>
        </div>

        <!-- Rejected Entries (if any) -->
        {% set rejected_entries = s.entries | selectattr('status', 'equalto', 'REJECTED') | list %}
        {% if rejected_entries %}
        <div style="margin-bottom: var(--space-4); padding: var(--space-3); background: var(--color-danger-50); border: 1px solid var(--color-danger-200); border-radius: var(--radius);">
          <h4 style="font-size: var(--text-sm); font-weight: var(--font-semibold); color: var(--color-danger-700); margin-bottom: var(--space-2);">Rejected Entries</h4>
          <div style="font-size: var(--text-xs); color: var(--color-danger-700);">
            {%- for entry in rejected_entries %}
            <div style="margin-bottom: var(--space-1);">
              <strong>{{ entry.name }}</strong> ({{ entry.email }}): {{ entry.rejection_reason or 'No reason provided' }}
            </div>
            {%- endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Hours Data Preview -->
        <div style="margin-bottom: var(--space-4);">
          <h4 style="font-size: var(--text-sm); font-weight: var(--font-semibold); margin-bottom: var(--space-2);">Volunteer Hours</h4>
          <div style="background: var(--color-gray-50); padding: var(--space-3); border-radius: var(--radius); max-height: 200px; overflow-y: auto;">
            <table style="width: 100%; font-size: var(--text-xs);">
              <thead>
                <tr style="border-bottom: 1px solid var(--color-gray-300);">
                  <th style="text-align: left; padding: var(--space-1); font-weight: var(--font-semibold);">Name</th>
                  <th style="text-align: left; padding: var(--space-1); font-weight: var(--font-semibold);">Email</th>
                  <th style="text-align: right; padding: var(--space-1); font-weight: var(--font-semibold);">Hours</th>
                  <th style="text-align: center; padding: var(--space-1); font-weight: var(--font-semibold);">Status</th>
                </tr>
              </thead>
              <tbody>
                {%- for entry in s.entries %}
                <tr style="border-bottom: 1px solid var(--color-gray-200);">
                  <td style="padding: var(--space-1);">{{ entry.name }}</td>
                  <td style="padding: var(--space-1);">{{ entry.email }}</td>
                  <td style="padding: var(--space-1); text-align: right;">{{ "%.1f"|format(entry.hours) }}</td>
                  <td style="padding: var(--space-1); text-align: center;">{{ ui.status_badge(entry.status) }}</td>
                </tr>
                {%- endfor %}
              </tbody>
            </table>
          </div>
        </div>
      {% endcall %}
      {%- endfor %}
    </div>
  {% else %}
    {% call ui.card(title='No Submissions Yet') %}
      {{ ui.empty_state(
        'Start Tracking Hours!',
        'You haven\'t submitted any bulk volunteer hours yet. Use the Submit Hours page to get started.'
      ) }}
    {% endcall %}
  {% endif %}
</div>
{% endblock %}